<view class="container">
    <custom-nav-bar title="佛大二手交易小程序" />
    <!-- 顶部绿色和标题 -->
    <view class="header">
      <image class="title-icon" src="../../static/cbd8df91d3ffa252fdf486a479bd07b.png" mode="aspectFit" />
      <van-search
        value="{{ value }}"
        shape="round"
        background="#FBEC9B"
        placeholder="请输入搜索关键词"
        class="search-bar"
        bind:search="onSearch"
        bind:input="onSearchInput"
        bind:focus="onSearchFocus"
        bind:blur="onSearchBlur"
      />
    </view>
    
    <!-- 搜索历史和热门关键词面板 -->
    <view wx:if="{{showHistory}}" class="search-history-panel">
      <!-- 热门搜索 -->
      <view class="history-section">
        <view class="history-header">
          <text class="history-title">热门搜索</text>
        </view>
        <view class="history-tags">
          <block wx:for="{{['手机', '电脑', '书籍', '耳机']}}" wx:key="index">
            <view class="history-tag" bindtap="searchByHistory" data-keyword="{{item}}">
              <text>{{item}}</text>
            </view>
          </block>
        </view>
      </view>

      <!-- 搜索历史 -->
      <view wx:if="{{historyKeywords.length > 0}}" class="history-section">
        <view class="history-header">
          <text class="history-title">搜索历史</text>
          <text class="clear-history" bindtap="clearSearchHistory">清空</text>
        </view>
        <view class="history-tags">
          <block wx:for="{{historyKeywords}}" wx:key="index">
            <view class="history-tag" bindtap="searchByHistory" data-keyword="{{item}}">
              <text>{{item}}</text>
            </view>
          </block>
        </view>
      </view>
    </view>
    
    <!-- 先放下拉栏 -->
    <view class="filter-bar-wrapper">
      <view class="filter-bar-horizontal">
        <view class="filter-item-horizontal" bindtap="toggleCampusDropdown">
          <text>{{selectedCampus || '校区'}}</text>
          <image src="/static/assets/icons/arrowdown.png" class="filter-arrow-horizontal" />
        </view>
        <view class="filter-item-horizontal" bindtap="toggleCategoryDropdown">
          <text>{{selectedCategory || '分类'}}</text>
          <image src="/static/assets/icons/arrowdown.png" class="filter-arrow-horizontal" />
        </view>
      </view>
      <!-- 校区下拉框 -->
      <view class="dropdown" wx:if="{{showCampusDropdown}}">
        <view class="dropdown-option" wx:for="{{campusOptions}}" wx:key="item" bindtap="selectCampus" data-value="{{item}}">{{item}}</view>
      </view>
      <!-- 分类下拉框 -->
      <view class="dropdown" wx:if="{{showCategoryDropdown}}">
        <view class="dropdown-option" wx:for="{{categoryOptions}}" wx:key="item" bindtap="selectCategory" data-value="{{item}}">{{item}}</view>
      </view>
    </view>
    <!-- 再放标签栏 -->
    <view class="fixed-tabs">
      <van-tabs active="{{ active }}" bind:change="onTabChange">
        <van-tab title="猜你喜欢" />
        <van-tab title="最新发布" />
        <van-tab title="免费赠送" />
        <van-tab title="求购专区" />
        <van-tab title="租赁服务" />
        <van-tab title="毕业甩卖" />
      </van-tabs>
    </view>
    <!-- 可滚动内容区域 -->
    <view wx:if="{{netError}}" class="net-error-box">
      <image class="net-error-img" src="/static/assets/icons/net_error.png" mode="aspectFit"/>
      <view class="net-error-text">网络出错啦，请检查网络或点击下方按钮重试</view>
      <button class="net-error-btn" bindtap="reloadPage">刷新</button>
    </view>
    <scroll-view 
      wx:else
      scroll-y="true" 
      scroll-top="{{scrollTop}}" 
      class="scroll-content"
    >
      <waterfall-layout 
        goods-list="{{goodsList}}"
        loading="{{loading}}"
        noMore="{{!hasMore}}"
        bind:loadmore="onReachBottom"
      />
    </scroll-view>
  </view>
