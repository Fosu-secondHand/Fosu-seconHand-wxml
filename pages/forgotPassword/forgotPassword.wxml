<!-- pages/forgotPassword/forgotPassword.wxml -->
<view class="container">
  <!-- 顶部标题 -->
  <view class="header">
    <view class="title">找回密码</view>
    <view class="subtitle">按照指引重置您的账号密码</view>
  </view>

  <!-- 表单容器 -->
  <view class="form-container">
    <!-- 步骤指示器 -->
    <view class="steps">
      <view class="step {{step >= 1 ? 'active' : ''}}">
        <view class="step-number">{{step >= 1 ? '✓' : '1'}}</view>
        <view class="step-text">验证身份</view>
      </view>
      <view class="step-line {{step >= 2 ? 'active' : ''}}"></view>
      <view class="step {{step >= 2 ? 'active' : ''}}">
        <view class="step-number">{{step >= 2 ? '✓' : '2'}}</view>
        <view class="step-text">重置密码</view>
      </view>
      <view class="step-line {{step >= 3 ? 'active' : ''}}"></view>
      <view class="step {{step >= 3 ? 'active' : ''}}">
        <view class="step-number">{{step >= 3 ? '✓' : '3'}}</view>
        <view class="step-text">完成</view>
      </view>
    </view>

    <!-- 步骤1：验证身份 -->
    <view wx:if="{{step === 1}}">
      <!-- 用户名输入 -->
      <view class="input-group">
        <image class="input-icon" src="/static/assets/login/user.svg"></image>
        <input 
          class="input" 
          placeholder="请输入用户名" 
          placeholder-class="placeholder"
          value="{{username}}"
          bindinput="onUsernameInput"
          focus="true"
        />
      </view>

      <!-- 手机号输入 -->
      <view class="input-group">
        <image class="input-icon" src="/static/assets/login/phone.svg"></image>
        <input 
          class="input phone-input" 
          placeholder="请输入手机号" 
          placeholder-class="placeholder"
          value="{{phone}}"
          bindinput="onPhoneInput"
          type="number"
        />
        <button 
          class="code-btn {{isCountingDown ? 'disabled' : ''}}"
          size="mini"
          bindtap="getVerificationCode"
          disabled="{{isCountingDown}}"
        >
          {{isCountingDown ? countdown + 's后重发' : '获取验证码'}}
        </button>
      </view>

      <!-- 验证码输入 -->
      <view class="input-group">
        <image class="input-icon" src="/static/assets/login/code.svg"></image>
        <input 
          class="input" 
          placeholder="请输入验证码" 
          placeholder-class="placeholder"
          value="{{verificationCode}}"
          bindinput="onVerificationCodeInput"
          type="number"
        />
      </view>

      <!-- 错误提示 -->
      <view class="error-msg" wx:if="{{errorMsg}}">{{errorMsg}}</view>

      <!-- 验证按钮 -->
      <button 
        class="next-btn" 
        type="primary" 
        bindtap="verifyIdentity"
        loading="{{loading}}"
        disabled="{{loading}}"
      >
        下一步
      </button>
    </view>

    <!-- 步骤2：重置密码 -->
    <view wx:if="{{step === 2}}">
      <!-- 新密码输入 -->
      <view class="input-group">
        <image class="input-icon" src="/static/assets/login/new-lock.svg"></image>
        <input 
          class="input" 
          placeholder="请输入新密码" 
          placeholder-class="placeholder"
          value="{{newPassword}}"
          bindinput="onNewPasswordInput"
          password="true"
        />
      </view>

      <!-- 确认新密码 -->
      <view class="input-group">
        <image class="input-icon" src="/static/assets/login/confirm-lock.svg"></image>
        <input 
          class="input" 
          placeholder="请确认新密码" 
          placeholder-class="placeholder"
          value="{{confirmNewPassword}}"
          bindinput="onConfirmNewPasswordInput"
          password="true"
        />
      </view>

      <!-- 密码要求提示 -->
      <view class="password-tips">密码需包含6-20位字母、数字或符号</view>

      <!-- 错误提示 -->
      <view class="error-msg" wx:if="{{errorMsg}}">{{errorMsg}}</view>

      <!-- 返回按钮和提交按钮 -->
      <view class="button-group">
        <button 
          class="back-btn" 
          type="default" 
          bindtap="backToStep1"
          loading="{{loading}}"
          disabled="{{loading}}"
        >
          上一步
        </button>
        <button 
          class="next-btn" 
          type="primary" 
          bindtap="resetPassword"
          loading="{{loading}}"
          disabled="{{loading}}"
        >
          提交
        </button>
      </view>
    </view>

    <!-- 步骤3：完成 -->
    <view wx:if="{{step === 3}}" class="success-container">
      <view class="success-icon">
        <image src="/static/assets/login/success.svg"></image>
      </view>
      <view class="success-text">密码重置成功</view>
      <view class="success-subtext">您的密码已更新，请使用新密码登录</view>
      <button 
        class="login-btn" 
        type="primary" 
        bindtap="goToLogin"
      >
        前往登录
      </button>
    </view>
  </view>

  <!-- 背景装饰 -->
  <image class="background-decoration" src="/static/assets/login/bg-pattern.svg" mode="scaleToFill"></image>
</view>