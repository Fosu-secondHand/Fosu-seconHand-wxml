<!-- 顶部导航栏 -->
<custom-nav-bar title="商品详情" showBack="true" />

<!-- 页面加载状态 -->
<view wx:if="{{loading}}" class="loading-container">
  <loading />
</view>

<!-- 页面错误状态 -->
<view wx:elif="{{error}}" class="error-container">
  <net-error bind:retry="onRetry" />
</view>

<!-- 主要内容 -->
<view wx:else class="container">
  <!-- 商品主图 -->
  <view class="main-image">
    <image
      src="{{goodsDetail.image}}"
      mode="aspectFill"
      lazy-load
      class="main-image-item"
    />
  </view>

  <!-- 商品信息区 -->
  <view class="goods-content">
    <view class="goods-price-row">
      <view class="goods-price">
        <text class="price-symbol">¥</text>
        <text class="price-number">{{goodsDetail.price}}</text>
      </view>
         <text class="condition">| {{goodsDetail.condition === 'NEW' ? '全新' : goodsDetail.condition === 'LIKE_NEW' ? '几乎全新' : goodsDetail.condition === 'GOOD' ? '轻微使用痕迹' : goodsDetail.condition === 'FAIR' ? '明显使用痕迹' : goodsDetail.condition}}</text>
    </view>
    <view class="goods-title">{{goodsDetail.title}}</view>

    <!-- 基础信息 -->
    <view class="info-item">
      <text class="label">所在地：</text>
      <text class="value">{{goodsDetail.campus}} {{goodsDetail.seller.address}}</text>
    </view>

    <view class="info-item">
      <text class="label">已售：</text>
      <text class="value">{{goodsDetail.soldCount}}件</text>
    </view>

    <view class="info-item">
      <text class="label">发布时间：</text>
      <text class="value">{{formattedPostTime}}</text>
    </view>
    <view class="info-item">
      <text class="label">交易方式：</text>
      <text class="value">{{goodsDetail.transactionMethod === 'Pickup' ? '自取' : goodsDetail.transactionMethod === 'Delivery' ? '送货上门' : goodsDetail.transactionMethod}}</text>
    </view>

    <!-- 统计信息 -->
    <view class="stats">
      <text class="stat-item">
        <icon type="star" size="18" color="#FFD700"></icon>
        <text>{{starCount}}人收藏</text>
      </text>
      <text class="stat-item">
        <icon type="like" size="18" color="#FF5A5F"></icon>
        <text>{{wantCount}}人想要</text>
      </text>
      <text class="stat-item">
        <icon type="eye" size="18" color="#999"></icon>
        <text>{{viewCount}}浏览</text>
      </text>
    </view>
  </view>

 <!-- 推荐商品瀑布流 -->
 <view class="recommend-section">
   <view class="section-title-container">
     <text class="section-title">为你推荐</text>
   </view>

   <!-- 加载状态 -->
   <view wx:if="{{recommendLoading}}" class="loading-container">
     <loading />
     <text>加载推荐商品中...</text>
   </view>

   <!-- 空状态 -->
   <view wx:elif="{{recommendGoods.length === 0 && !recommendLoading}}" class="empty-container">
     <text class="empty-text">暂无推荐商品</text>
   </view>

   <!-- 商品列表 -->
   <view wx:else class="goods-list">
     <block wx:for="{{recommendGoods}}" wx:key="productId">
       <view class="goods-item" bindtap="onGoodsTap" data-id="{{item.productId}}">
         <!-- 商品图片 -->
         <image class="goods-image"
                src="{{item.image[0] || item.image || '/static/assets/default-image.png'}}"
                mode="aspectFill"
                lazy-load></image>

         <!-- 商品信息 -->
         <view class="goods-info">
           <text class="goods-title">{{item.title}}</text>
           <text class="goods-price">¥{{item.price}}</text>
           <view class="goods-meta">
             <text class="goods-condition">{{item.condition}}</text>
             <text class="goods-favorite-count">{{item.favoriteCount || 0}}人收藏</text>
           </view>
         </view>
       </view>
     </block>
   </view>
 </view>

</view>

<!-- 收藏星号左下角 -->
<view class="star-float-btn" bindtap="handleStar">
  <image src="{{isStarred ? '/static/assets/icons/star-filled.png' : '/static/assets/icons/star-outline.png'}}" class="star-img" />
</view>

<!-- 底部操作栏 -->
<view class="bottom-actions">
  <button class="message-btn" bindtap="handleChat">
    <icon type="message" size="18" color="#333"></icon>
    <text>聊一聊</text>
  </button>
  <button class="want-btn" bindtap="handleBuy">
    <text>立即购买</text>
  </button>
</view>
